<?xml version="1.0"?><Report><ReportQuery><Format><ReportTitle>Charge de travail hebdo</ReportTitle><ReportDescription></ReportDescription><PageSize>.DEFAULT</PageSize><PageOrientation>.DEFAULT</PageOrientation><TopMargin></TopMargin><BottomMargin></BottomMargin><RightMargin></RightMargin><LeftMargin></LeftMargin><pdfFont></pdfFont><pdfFontSize></pdfFontSize><PreExecuteCode>NONE</PreExecuteCode><formBetweenRows>solidline</formBetweenRows><gridDisplay>.DEFAULT</gridDisplay><gridSortable>.DEFAULT</gridSortable><gridSearchable>.DEFAULT</gridSearchable><gridPageable>.DEFAULT</gridPageable><gridPageSize>.DEFAULT</gridPageSize></Format><Datasource><SourceType>database</SourceType><SourceConnection><DatabaseType>mysql</DatabaseType><DatabaseName></DatabaseName><HostName></HostName><ServiceName></ServiceName><UserName></UserName><Password></Password></SourceConnection></Datasource><EntryForm><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection>all</RowSelection><SQL><QuerySql></QuerySql><SQLRaw>SELECT 
	WEEK(IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline),3 ) Semaine, 
YEAR(IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline)) annee,    
    SUM(llx_ticketsup_extrafields.heure_est)*2 DureEst,
	COUNT(llx_ticketsup.track_id) NBTicket,
	Conges.conges
FROM llx_ticketsup
LEFT JOIN 
	(SELECT llx_commande.rowid bc, llx_ticketsup.ref, llx_ticketsup.track_id track_id
		FROM llx_element_element, llx_ticketsup, llx_commande
			Where llx_element_element.targettype = 'ticketsup' AND llx_element_element.sourcetype = 'commande'
			AND llx_ticketsup.rowid = llx_element_element.fk_target AND llx_ticketsup.fk_statut &lt; 8  AND llx_element_element.fk_source = llx_commande.rowid
	UNION
	SELECT llx_commande.rowid bc, llx_ticketsup.ref, llx_ticketsup.track_id track_id
		FROM llx_element_element, llx_ticketsup, llx_commande
			Where llx_element_element.sourcetype = 'ticketsup' AND llx_element_element.targettype = 'commande'
			AND llx_ticketsup.rowid = llx_element_element.fk_source AND llx_ticketsup.fk_statut &lt; 8  AND llx_element_element.fk_target = llx_commande.rowid) AS Ticket ON llx_ticketsup.track_id = Ticket.track_id
LEFT JOIN llx_commande ON Ticket.bc = llx_commande.rowid
LEFT JOIN llx_projet ON llx_ticketsup.fk_project = llx_projet.rowid
LEFT JOIN llx_user ON llx_user.rowid = llx_ticketsup.fk_user_assign
LEFT JOIN llx_commande_extrafields ON llx_commande_extrafields.fk_object = llx_commande.rowid
LEFT JOIN llx_ticketsup_extrafields ON llx_ticketsup.rowid = llx_ticketsup_extrafields.fk_object
LEFT JOIN llx_c_ticketsup_type ON llx_c_ticketsup_type.code = llx_ticketsup.type_code
LEFT JOIN 
	(SELECT week(llx_holiday.date_debut,3) numweek,if(SUM(if(datediff(llx_holiday.date_fin,llx_holiday.date_debut)+abs(llx_holiday.halfday)=0,7,(datediff(llx_holiday.date_fin,llx_holiday.date_debut)+abs(llx_holiday.halfday))*7))/35 &gt;1,
 
	if(dayofweek(llx_holiday.date_debut)=2,35,
		if(dayofweek(llx_holiday.date_debut)=3,28,
			if(dayofweek(llx_holiday.date_debut)=4,21,
				if(dayofweek(llx_holiday.date_debut)=5,14,7)
				)
			)
		)                                                                                                                             ,SUM(if(datediff(llx_holiday.date_fin,llx_holiday.date_debut)+abs(llx_holiday.halfday)=0,7,(datediff(llx_holiday.date_fin,llx_holiday.date_debut)+abs(llx_holiday.halfday))*7))) conges
FROM dolibarr.llx_c_holiday_types, dolibarr.llx_holiday, dolibarr.llx_user, llx_usergroup_user
WHERE llx_holiday.fk_type = llx_c_holiday_types.rowid 
AND llx_holiday.fk_user = llx_user.rowid
AND llx_usergroup_user.fk_user = llx_user.rowid
AND llx_usergroup_user.fk_usergroup = 2
AND llx_holiday.statut &lt; 5
AND year(llx_holiday.date_debut) = year(now())
GROUp BY week(llx_holiday.date_debut,3)
ORDER BY week(llx_holiday.date_debut,3)) AS Conges ON Conges.numweek = WEEK(IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline),3)
WHERE llx_ticketsup.fk_statut &lt; 8  
AND llx_ticketsup.category_code IN(&quot;CMD&quot;,&quot;INTERNE&quot;,&quot;EQUIPEMENT&quot;)
AND IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline) &gt;= DATE_SUB(NOW(), INTERVAL 15 DAY)
GROUP BY WEEK(IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline),3 )
ORDER BY IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline) ASC</SQLRaw></SQL><QueryColumns><QueryColumn><Name>Semaine</Name><TableName></TableName><ColumnName>WEEK(IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline),3 )</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>annee</Name><TableName></TableName><ColumnName>YEAR(IFNULL(DateOperation(llx_commande_extrafields.datelivraisonprev, llx_commande_extrafields.dateenlevementprev, llx_commande_extrafields.date_assemblage, llx_commande.date_livraison, llx_commande_extrafields.cmd_type_tpt,  llx_commande.date_commande),llx_ticketsup_extrafields.deadline))</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>DureEst</Name><TableName></TableName><ColumnName>SUM(llx_ticketsup_extrafields.heure_est)*2</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Charge estimée (heures)</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>NBTicket</Name><TableName></TableName><ColumnName>COUNT(llx_ticketsup.track_id)</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Nombre de tickets</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>conges</Name><TableName>Conges</TableName><ColumnName>conges</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Congés (heures)</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>Dispos</Name><TableName></TableName><ColumnName></ColumnName><ColumnType></ColumnType><ColumnLength></ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Heures théoriquement disponibles</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>DispoQuotidien</Name><TableName></TableName><ColumnName></ColumnName><ColumnType></ColumnType><ColumnLength></ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Volume horaire quotidien dispo (par opérateur)</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><PreSQLS></PreSQLS></Query><Assignments><Assignment><AssignName>DureEst</AssignName><AssignNameNew></AssignNameNew><Expression>round({DureEst},0)</Expression><Condition></Condition></Assignment><Assignment><AssignName>Dispos</AssignName><AssignNameNew></AssignNameNew><Expression>120-{conges}-{DureEst}</Expression><Condition></Condition></Assignment><Assignment><AssignName>DispoQuotidien</AssignName><AssignNameNew></AssignNameNew><Expression>round(({Dispos}/5)/7,0)</Expression><Condition></Condition></Assignment><Assignment><AssignName>Dispos</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('ROW', 'background-color', '#F5D0A9');</Expression><Condition>{Dispos}&lt;20</Condition></Assignment><Assignment><AssignName>Dispos</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('ROW', 'background-color', '#F78181');</Expression><Condition>{Dispos}&lt;0</Condition></Assignment><Assignment><AssignName>Dispos</AssignName><AssignNameNew></AssignNameNew><Expression>85-{conges}-{DureEst}</Expression><Condition>{Semaine} &gt; 13 &amp;&amp; {Semaine} &lt; 30</Condition></Assignment></Assignments><Criteria></Criteria><Output><PageHeaders></PageHeaders><PageFooters></PageFooters><DisplayOrders><DisplayOrder><ColumnName>Semaine</ColumnName><OrderNumber>1</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>NBTicket</ColumnName><OrderNumber>2</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>DureEst</ColumnName><OrderNumber>3</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>conges</ColumnName><OrderNumber>4</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>Dispos</ColumnName><OrderNumber>5</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>DispoQuotidien</ColumnName><OrderNumber>6</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>annee</ColumnName><OrderNumber>7</OrderNumber></DisplayOrder></DisplayOrders><Groups><Group><GroupName>REPORT_BODY</GroupName><BeforeGroupHeader>blankline</BeforeGroupHeader><AfterGroupHeader>blankline</AfterGroupHeader><BeforeGroupTrailer>blankline</BeforeGroupTrailer><AfterGroupTrailer>blankline</AfterGroupTrailer><GroupHeaders></GroupHeaders><GroupTrailers></GroupTrailers></Group></Groups><Graphs><Graph><GraphColumn>REPORT_BODY</GraphColumn><GraphColor>.DEFAULT</GraphColor><Title>Charge de travail</Title><GraphWidth>.DEFAULT</GraphWidth><GraphHeight>.DEFAULT</GraphHeight><GraphWidthPDF>.DEFAULT</GraphWidthPDF><GraphHeightPDF>.DEFAULT</GraphHeightPDF><XTitle>Numéro de semaine</XTitle><YTitle>Valeur</YTitle><GridPosition>.DEFAULT</GridPosition><XGridDisplay>.DEFAULT</XGridDisplay><XGridColor>.DEFAULT</XGridColor><YGridDisplay>.DEFAULT</YGridDisplay><YGridColor>.DEFAULT</YGridColor><XLabelColumn>Semaine</XLabelColumn><TitleFont>.DEFAULT</TitleFont><TitleFontStyle>.DEFAULT</TitleFontStyle><TitleFontSize>.DEFAULT</TitleFontSize><TitleColor>.DEFAULT</TitleColor><XTitleFont>.DEFAULT</XTitleFont><XTitleFontStyle>.DEFAULT</XTitleFontStyle><XTitleFontSize>.DEFAULT</XTitleFontSize><XTitleColor>.DEFAULT</XTitleColor><YTitleFont>.DEFAULT</YTitleFont><YTitleFontStyle>.DEFAULT</YTitleFontStyle><YTitleFontSize>.DEFAULT</YTitleFontSize><YTitleColor>.DEFAULT</YTitleColor><XAxisColor>.DEFAULT</XAxisColor><XAxisFont>.DEFAULT</XAxisFont><XAxisFontStyle>.DEFAULT</XAxisFontStyle><XAxisFontSize>.DEFAULT</XAxisFontSize><XAxisFontColor>.DEFAULT</XAxisFontColor><YAxisColor>.DEFAULT</YAxisColor><YAxisFont>.DEFAULT</YAxisFont><YAxisFontStyle>.DEFAULT</YAxisFontStyle><YAxisFontSize>.DEFAULT</YAxisFontSize><YAxisFontColor>.DEFAULT</YAxisFontColor><XTickInterval>.DEFAULT</XTickInterval><YTickInterval>.DEFAULT</YTickInterval><XTickLabelInterval>.DEFAULT</XTickLabelInterval><YTickLabelInterval>.DEFAULT</YTickLabelInterval><MarginColor>.DEFAULT</MarginColor><MarginLeft>.DEFAULT</MarginLeft><MarginRight>.DEFAULT</MarginRight><MarginTop>.DEFAULT</MarginTop><MarginBottom>.DEFAULT</MarginBottom><Plots><Plot><PlotColumn>DureEst</PlotColumn><PlotType>STACKEDBAR</PlotType><LineColor></LineColor><DataType>number</DataType><Legend>Charge estimée (heures)</Legend><FillColor></FillColor></Plot><Plot><PlotColumn>conges</PlotColumn><PlotType>STACKEDBAR</PlotType><LineColor></LineColor><DataType>number</DataType><Legend>Congés</Legend><FillColor></FillColor></Plot><Plot><PlotColumn>Dispos</PlotColumn><PlotType>STACKEDBAR</PlotType><LineColor></LineColor><DataType>number</DataType><Legend>Temps disponible</Legend><FillColor></FillColor></Plot></Plots></Graph><Graph><GraphColumn>REPORT_BODY</GraphColumn><GraphColor>.DEFAULT</GraphColor><Title>Nombre de tickets</Title><GraphWidth>.DEFAULT</GraphWidth><GraphHeight>.DEFAULT</GraphHeight><GraphWidthPDF>.DEFAULT</GraphWidthPDF><GraphHeightPDF>.DEFAULT</GraphHeightPDF><XTitle>Semaine</XTitle><YTitle>Nombre de tickets</YTitle><GridPosition>.DEFAULT</GridPosition><XGridDisplay>.DEFAULT</XGridDisplay><XGridColor>.DEFAULT</XGridColor><YGridDisplay>.DEFAULT</YGridDisplay><YGridColor>.DEFAULT</YGridColor><XLabelColumn>Semaine</XLabelColumn><TitleFont>.DEFAULT</TitleFont><TitleFontStyle>.DEFAULT</TitleFontStyle><TitleFontSize>.DEFAULT</TitleFontSize><TitleColor>.DEFAULT</TitleColor><XTitleFont>.DEFAULT</XTitleFont><XTitleFontStyle>.DEFAULT</XTitleFontStyle><XTitleFontSize>.DEFAULT</XTitleFontSize><XTitleColor>.DEFAULT</XTitleColor><YTitleFont>.DEFAULT</YTitleFont><YTitleFontStyle>.DEFAULT</YTitleFontStyle><YTitleFontSize>.DEFAULT</YTitleFontSize><YTitleColor>.DEFAULT</YTitleColor><XAxisColor>.DEFAULT</XAxisColor><XAxisFont>.DEFAULT</XAxisFont><XAxisFontStyle>.DEFAULT</XAxisFontStyle><XAxisFontSize>.DEFAULT</XAxisFontSize><XAxisFontColor>.DEFAULT</XAxisFontColor><YAxisColor>.DEFAULT</YAxisColor><YAxisFont>.DEFAULT</YAxisFont><YAxisFontStyle>.DEFAULT</YAxisFontStyle><YAxisFontSize>.DEFAULT</YAxisFontSize><YAxisFontColor>.DEFAULT</YAxisFontColor><XTickInterval>.DEFAULT</XTickInterval><YTickInterval>.DEFAULT</YTickInterval><XTickLabelInterval>.DEFAULT</XTickLabelInterval><YTickLabelInterval>.DEFAULT</YTickLabelInterval><MarginColor>.DEFAULT</MarginColor><MarginLeft>.DEFAULT</MarginLeft><MarginRight>.DEFAULT</MarginRight><MarginTop>.DEFAULT</MarginTop><MarginBottom>.DEFAULT</MarginBottom><Plots><Plot><PlotColumn>NBTicket</PlotColumn><PlotType>AREACHART</PlotType><LineColor></LineColor><DataType>number</DataType><Legend></Legend><FillColor></FillColor></Plot></Plots></Graph></Graphs></Output></EntryForm></ReportQuery></Report>