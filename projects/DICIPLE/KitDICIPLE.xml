<?xml version="1.0"?><Report><ReportQuery><Format><ReportTitle>DICIPLE - Kits restants sur site (théorique)</ReportTitle><ReportDescription>Nombre de patients inclus et kits expédiés</ReportDescription><PageSize>.DEFAULT</PageSize><PageOrientation>.DEFAULT</PageOrientation><TopMargin></TopMargin><BottomMargin></BottomMargin><RightMargin></RightMargin><LeftMargin></LeftMargin><pdfFont></pdfFont><pdfFontSize></pdfFontSize><PreExecuteCode>NONE</PreExecuteCode><formBetweenRows>solidline</formBetweenRows><gridDisplay>show</gridDisplay><gridSortable>yes</gridSortable><gridSearchable>yes</gridSearchable><gridPageable>.DEFAULT</gridPageable><gridPageSize>.DEFAULT</gridPageSize></Format><Datasource><SourceType>database</SourceType><SourceConnection><DatabaseType>mysql</DatabaseType><DatabaseName></DatabaseName><HostName></HostName><ServiceName></ServiceName><UserName></UserName><Password></Password></SourceConnection></Datasource><EntryForm><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection>all</RowSelection><SQL><QuerySql></QuerySql><SQLRaw>SELECT T2.code_centre Centre, patient Patients ,quantite Quantite, IF(patient IS NULL,quantite, quantite-patient) Restant  FROM 
(SELECT llx_cust_SuiviPatientsDetails_extrafields.collectioncenter AS 'code_centre', COUNT(llx_cust_SuiviPatientsDetails_extrafields.patientid) AS 'patient'
FROM llx_cust_SuiviPatientsDetails_extrafields, llx_projet
WHERE (llx_projet.rowid=llx_cust_SuiviPatientsDetails_extrafields.fk_object) AND (llx_projet.ref='PJ1706-IFC-139')
GROUP BY llx_cust_SuiviPatientsDetails_extrafields.collectioncenter) AS T1
RIGHT JOIN (SELECT DISTINCT(llx_expedition.ref), llx_expedition_extrafields.code_centre AS 'code_centre' , SUM(llx_expeditiondet.qty) AS 'quantite' 
FROM llx_expedition 
LEFT JOIN llx_expeditiondet ON llx_expeditiondet.fk_expedition = llx_expedition.rowid
LEFT JOIN llx_expedition_extrafields ON llx_expedition_extrafields.fk_object = llx_expedition.rowid
LEFT JOIN llx_commandedet ON llx_commandedet.rowid = llx_expeditiondet.fk_origin_line
LEFT JOIN llx_commande ON llx_commande.rowid = llx_commandedet.fk_commande
LEFT JOIN llx_product ON llx_commandedet.fk_product = llx_product.rowid
LEFT JOIN llx_projet ON llx_projet.rowid = llx_commande.fk_projet
WHERE ((llx_projet.ref= 'PJ1706-IFC-139') AND (llx_commande.fk_statut&gt;1)) AND llx_product.ref = 'P0218365' [AND llx_expedition_extrafields.code_centre IN( {CollectionCenter})]
GROUP BY  llx_expedition_extrafields.code_centre, llx_product.ref) AS T2 ON T1.code_centre = T2.code_centre 
WHERE 1=1 [AND IF(patient IS NULL,quantite, quantite-patient) &lt; {KitRestant}]
ORDER BY Restant </SQLRaw></SQL><QueryColumns><QueryColumn><Name>Centre</Name><TableName>T2</TableName><ColumnName>code_centre</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Centre d'inclusion</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>Patients</Name><TableName></TableName><ColumnName>patient</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Nombre de patients inclus</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>Quantite</Name><TableName></TableName><ColumnName>quantite</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Quantité de kits expédiés</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>Restant</Name><TableName></TableName><ColumnName>IF(patient IS NULL,quantite, quantite-patient)</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Quantité de kits théorique</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><PreSQLS><PreSQL><SQLText>-- Enter SQL</SQLText></PreSQL></PreSQLS></Query><Assignments><Assignment><AssignName>Restant</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('CELL', 'background-color', '#B3FF68');</Expression><Condition>{Restant} &gt; 3</Condition></Assignment><Assignment><AssignName>Restant</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('CELL', 'background-color', '#F7E760');</Expression><Condition>{Restant} &lt; 2 &amp;&amp; {Restant} &gt; 0</Condition></Assignment><Assignment><AssignName>Restant</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('ROW', 'background-color', '#F76060');</Expression><Condition>{Restant}&lt; 1</Condition></Assignment></Assignments><Criteria><CriteriaItem><Name>CollectionCenter</Name><Title>CollectionCenter</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>LOOKUP</CriteriaType><CriteriaHelp></CriteriaHelp><CriteriaDisplay>DROPDOWN</CriteriaDisplay><ExpandDisplay>CHECKBOX</ExpandDisplay><CriteriaRequired>no</CriteriaRequired><CriteriaHidden>no</CriteriaHidden><CriteriaDisplayGroup></CriteriaDisplayGroup><ReturnColumn>CollectionCenter</ReturnColumn><DisplayColumn>CollectionCenter</DisplayColumn><OverviewColumn>CollectionCenter</OverviewColumn><MatchColumn>CollectionCenter</MatchColumn><CriteriaDefaults>*</CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw>SELECT llx_expedition_extrafields.code_centre CollectionCenter
FROM llx_expedition 
LEFT JOIN llx_expeditiondet ON llx_expeditiondet.fk_expedition = llx_expedition.rowid
LEFT JOIN llx_expeditiondet_batch ON llx_expeditiondet.rowid = llx_expeditiondet_batch.fk_expeditiondet
LEFT JOIN llx_expedition_extrafields ON llx_expedition_extrafields.fk_object = llx_expedition.rowid
LEFT JOIN llx_commandedet ON llx_commandedet.rowid = llx_expeditiondet.fk_origin_line
LEFT JOIN llx_commande ON llx_commande.rowid = llx_commandedet.fk_commande
LEFT JOIN llx_product ON llx_commandedet.fk_product = llx_product.rowid
LEFT JOIN llx_projet ON llx_projet.rowid = llx_commande.fk_projet
LEFT JOIN llx_societe ON llx_commande.fk_soc = llx_societe.rowid
LEFT JOIN llx_product_batch ON llx_product_batch.batch = llx_expeditiondet_batch.batch
LEFT JOIN llx_c_shipment_mode ON llx_c_shipment_mode.rowid = llx_expedition.fk_shipping_method
LEFT JOIN llx_commande_extrafields ON llx_commande.rowid = llx_commande_extrafields.fk_object
WHERE ((llx_projet.ref= 'PJ1706-IFC-139') AND (llx_commande.fk_statut&gt;1)) AND llx_product.ref = 'P0218365'
GROUP BY  llx_expedition_extrafields.code_centre</SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns><QueryColumn><Name>CollectionCenter</Name><TableName>llx_expedition_extrafields</TableName><ColumnName>code_centre</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>KitRestant</Name><Title>Nombre de kits restants</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>TEXTFIELD</CriteriaType><CriteriaHelp></CriteriaHelp><CriteriaDisplay>TEXTFIELD</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><CriteriaRequired>.DEFAULT</CriteriaRequired><CriteriaHidden>.DEFAULT</CriteriaHidden><CriteriaDisplayGroup></CriteriaDisplayGroup><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem></Criteria><Output><PageHeaders><PageHeader><LineNumber>1</LineNumber><HeaderText>Suivi des kits pour le projet DICIPLE</HeaderText><Format><ColumnStartPDF></ColumnStartPDF><justify>center</justify><ColumnWidthPDF></ColumnWidthPDF><ShowInPDF>yes</ShowInPDF><ShowInHTML>no</ShowInHTML></Format></PageHeader></PageHeaders><PageFooters></PageFooters><DisplayOrders><DisplayOrder><ColumnName>Centre</ColumnName><OrderNumber>1</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>Patients</ColumnName><OrderNumber>2</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>Quantite</ColumnName><OrderNumber>3</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>Restant</ColumnName><OrderNumber>4</OrderNumber></DisplayOrder></DisplayOrders><Groups><Group><GroupName>REPORT_BODY</GroupName><BeforeGroupHeader>blankline</BeforeGroupHeader><AfterGroupHeader>blankline</AfterGroupHeader><BeforeGroupTrailer>blankline</BeforeGroupTrailer><AfterGroupTrailer>blankline</AfterGroupTrailer><GroupHeaders></GroupHeaders><GroupTrailers></GroupTrailers></Group></Groups><Graphs><Graph><GraphColumn>REPORT_BODY</GraphColumn><GraphColor>.DEFAULT</GraphColor><Title>Kits par centres</Title><GraphWidth>.DEFAULT</GraphWidth><GraphHeight>.DEFAULT</GraphHeight><GraphWidthPDF>.DEFAULT</GraphWidthPDF><GraphHeightPDF>.DEFAULT</GraphHeightPDF><XTitle>Centre</XTitle><YTitle>Nombre de kits et patients inclus</YTitle><GridPosition>.DEFAULT</GridPosition><XGridDisplay>.DEFAULT</XGridDisplay><XGridColor>.DEFAULT</XGridColor><YGridDisplay>.DEFAULT</YGridDisplay><YGridColor>.DEFAULT</YGridColor><XLabelColumn>Centre</XLabelColumn><TitleFont>.DEFAULT</TitleFont><TitleFontStyle>.DEFAULT</TitleFontStyle><TitleFontSize>.DEFAULT</TitleFontSize><TitleColor>.DEFAULT</TitleColor><XTitleFont>.DEFAULT</XTitleFont><XTitleFontStyle>.DEFAULT</XTitleFontStyle><XTitleFontSize>.DEFAULT</XTitleFontSize><XTitleColor>.DEFAULT</XTitleColor><YTitleFont>.DEFAULT</YTitleFont><YTitleFontStyle>.DEFAULT</YTitleFontStyle><YTitleFontSize>.DEFAULT</YTitleFontSize><YTitleColor>.DEFAULT</YTitleColor><XAxisColor>.DEFAULT</XAxisColor><XAxisFont>.DEFAULT</XAxisFont><XAxisFontStyle>.DEFAULT</XAxisFontStyle><XAxisFontSize>.DEFAULT</XAxisFontSize><XAxisFontColor>.DEFAULT</XAxisFontColor><YAxisColor>.DEFAULT</YAxisColor><YAxisFont>.DEFAULT</YAxisFont><YAxisFontStyle>.DEFAULT</YAxisFontStyle><YAxisFontSize>.DEFAULT</YAxisFontSize><YAxisFontColor>.DEFAULT</YAxisFontColor><XTickInterval>.DEFAULT</XTickInterval><YTickInterval>.DEFAULT</YTickInterval><XTickLabelInterval>.DEFAULT</XTickLabelInterval><YTickLabelInterval>.DEFAULT</YTickLabelInterval><MarginColor>.DEFAULT</MarginColor><MarginLeft>.DEFAULT</MarginLeft><MarginRight>.DEFAULT</MarginRight><MarginTop>.DEFAULT</MarginTop><MarginBottom>.DEFAULT</MarginBottom><Plots><Plot><PlotColumn>Quantite</PlotColumn><PlotType>BAR</PlotType><LineColor></LineColor><DataType>number</DataType><Legend>Nombre de kits envoyés</Legend><FillColor></FillColor></Plot><Plot><PlotColumn>Restant</PlotColumn><PlotType>BAR</PlotType><LineColor></LineColor><DataType>number</DataType><Legend>Nombre de kits restant</Legend><FillColor></FillColor></Plot><Plot><PlotColumn>Patients</PlotColumn><PlotType>LINE</PlotType><LineColor></LineColor><DataType>number</DataType><Legend>Nombre de patients inclus</Legend><FillColor></FillColor></Plot></Plots></Graph></Graphs></Output></EntryForm></ReportQuery></Report>